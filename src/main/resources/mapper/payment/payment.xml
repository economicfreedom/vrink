<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.green.vrink.payment.repository.interfaces.PaymentRepository">
	<select id="findByEditorId" resultType="com.green.vrink.payment.dto.PriceDTO">
		SELECT * FROM test_price 
		WHERE editor_id = #{editorId}
	</select>

    <insert id="insertByPayment">
		INSERT INTO payment (user_id, editor_id, name, imp_uid, merchant_uid, price)
		VALUES (#{userId}, #{editorId}, #{name}, #{impUid}, #{merchantUid}, #{price})
	</insert>

    <select id="findByUserId" resultType="com.green.vrink.payment.repository.model.Payment">
		SELECT payment_id, user_id, name, imp_uid, merchant_uid, price, date_format(created_at,'%y-%m-%d %h:%i') as created_at
		FROM payment WHERE user_id = #{userId} ORDER BY payment_id DESC;
	</select>

	<insert id="insertByPaymentState">
		INSERT INTO payment_state (payment_id, point)
		values (#{paymentId}, #{point})
	</insert>

	<select id="findByCancelData" resultType="com.green.vrink.payment.repository.model.Payment">
		SELECT * FROM payment WHERE payment_id = #{paymentId}
	</select>

	<select id="findByPaymentId" resultType="java.lang.Integer">
		SELECT * FROM payment ORDER BY payment_id DESC LIMIT 1;
	</select>
    <select id="findBuyListByUserId" resultType="com.green.vrink.payment.dto.BuyResponseDTO">
        SELECT ps.point, customer_recognize, payment_state_id, ps.created_at, u.nickname, p.editor_id, p.user_id
        FROM payment_state ps
                 LEFT JOIN payment p ON ps.payment_id = p.payment_id
                 LEFT JOIN editor_detail ed ON ed.editor_id = p.editor_id
                 LEFT JOIN user u ON ed.user_id = u.user_id
        WHERE p.user_id = #{userId}
          AND customer_recognize = 0
    </select>
</mapper>